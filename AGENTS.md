# AI Agent Blueprint

## Purpose
- 将用户自然语言意图转成可执行计划与输出，用户无需触碰命令行或按钮。
- 先复用现有工具/脚本/playbook，缺口再最小化扩展。
- 提前澄清阻塞信息，给出精简计划，经确认后自动执行；产出可直接使用并给出路径/验证状态。
- 数据目录约定：`artifacts/` 作为 ETL 输出与后续分析加工的集中目录，所有本地生成物保持可追溯；`data/` 为历史调试目录，逐步淘汰。

## 互动契约（附加模块）
- 交互渠道只有自然语言；不要求用户点击/运行命令。
- 需补充的信息尽量一次性收集，减少往返。
- 安全/权限/网络敏感操作先说明需求与影响；缺依赖或无权限时给出替代/降级方案。
- 对话统一用简体中文；输出路径/链接可点击可触发（如 `file://...`、Bear x-callback）。
- 协作/流程/命名等约束请见 `.specify/memory/constitution.md` 与 `specs/spec.md`。

## Tools
- `python3` 3.14.0：首选脚本/数据处理/快速 Web 生成，必要时自建虚拟环境。
- `node` 24.3.0 / `npm` 11.4.2：JS/TS 脚本、前端构建或本地渲染。
- `git` 2.39.5：获取上下文、diff、打包交付。
- `rg` 14.1.1：代码/文本快速搜索（优先于 grep）。常用：`rg "<pattern>" <path>`。
- `jq` 1.8.1：JSON 处理。常用：`jq '<filter>' file.json`。
- Shell/zsh 与基础核心工具（cat, sed, awk, sort, tar, zip, open 等）默认可用。
- 未安装：`fd`、`go`、`rustc`/`cargo`、`deno`（避免依赖，必要时先申请安装或提供替代方案）。

## Playbooks
- 生成今日复盘 dashboard  
  1) 数据源：屏幕使用与 mood 数据（若未配置路径，先用自然语言确认来源或格式）；  
  2) 预处理：校验时间范围为“今日”，缺失字段填充或标记；  
  3) 生成：用 Python/JS 将指标（总用时、分应用/分时段、情绪趋势/波动）渲染为单页 HTML，内嵌图表库或纯 SVG；  
  4) 呈现：将产物写入 `./artifacts/daily-dashboard-YYYY-MM-DD.html`，用 `open` 调起默认浏览器；  
  5) 汇报：返回摘要、文件路径、关键截图或指标表，并记录已用工具与潜在改进。

- 通用需求处理模板  
  1) 解析意图与约束（数据源、截止时间、输出格式）；  
  2) 映射已存在的 playbook；若无，则设计最小可行流程；  
  3) 选择最少工具组合，执行并自检（格式/一致性/可运行性）；  
  4) 交付产物路径与验证结果，若有残余风险给出下一步选项。

- 代码/数据改动流水线  
  1) `rg`/`git` 获取上下文；  
  2) 设计变更方案与影响面（兼容性/性能/数据风险）；  
  3) 实施改动（Python/Node/脚本），必要时添加轻量校验或样例；  
  4) 自测或静态检查（如格式/快速脚本验证），汇报差异与待办测试。

## 失败与恢复（附加模块）
- 若工具报错：先最小化重试（参数/路径校验），再提供替代方案或降级交付。
- 若数据缺失：列出可接受的替代输入或假设，并注明对结果的影响。
- 任何无法自动完成的环节，输出明确的手工待办说明和预期耗时。

## 约定补充
- 问题记录：默认集中在 `docs/solveProblems/icalbuddy-calendar-permission.md` 维护你交代的排障/问题记录（包含权限但不限于此），体积过大或跨多个 feat 时再按 feat/规模拆分新文件并保持链接。
- 参考 `specs/spec.md` 了解 Futures 总览与“架构桥”三句话约定（发现架构问题但不影响当前交付时，用 RFC+Backlog 记录，当前 Sprint 照常推进）。
