# 时间与精力可视化规范（Future）

## 目标
- 构建本地周视图仪表盘，展示：应用类别耗时、精力趋势、突发任务、日历事件概览。
- 数据源全部本地：ActivityWatch（应用/网页）、日历（事件块）、MoodExample（精力评分），未来可扩展到 Whisper/任务系统。

## 范围
- 视图切换：日/周/月/年（默认周）；日历事件表格与上方卡片联动。
- 周视图：支持本周/上周切换。
- 模块：
  - 应用类别耗时：按日历类别（Calendar `calendar` 字段）聚合并在各时间粒度显示总时长；右侧显示与上一周期的环比百分比（箭头+百分比，涨/跌）。
  - 精力趋势：早/午/晚 1-10 分折线，周视图可切换本周/上周；维度下拉含 stamina/emotion/willpower/cognition/全部。选择“全部”时展示本周四条折线；选择单一维度时展示本周一条 + 上周对比一条。
  - 突发任务：按天统计数量，默认周视图，展示本周 vs 上周双折线，用于复盘突发/擦屁股任务及 SOP 潜力。
  - 日历事件概览：按日分组显示时间段、标题、类别、时长、关联任务，随日/周/月/年切换联动。
- 数据口径：
  - 日期：以本地日为准，所有时间使用 ISO 8601。
  - 耗时校验：应用耗时总和需与日历事件总时长一致（可提示差异）。
  - 精力：来自 MoodExample 或本地 JSONL，缺段时占位提示。
  - 突发任务：事件计数或标签标记，缺失时提示“无记录/未接入”。

## 非范围
- 不做联网服务与云端存储；仅本地文件。
- 不做账号系统与协同。
- 不做自动安装 ActivityWatch/MoodExample，仅提供使用指引。

## 数据文件约定（示例路径，均在 data/ 下）
- `data/calendar/<date>.json`：日历事件 Mock/真实导出，字段至少含 `title`, `start`, `end`, `calendar`, `category`, `notes`。
- `data/activitywatch/<date>.json`：`scripts/fetch_aw.py` 输出，含 buckets、events、聚合。
- `data/mood/log.jsonl`：`scripts/log_mood.py` 或 MoodExample 导出，字段 `day`, `slot`, `score`, `tags`, `notes`。
- `data/aggregates/<week>.json`：周级归一化（汇总上述数据），供渲染。

## 可视化设计（对应参考图）
- 左：应用类别耗时（柱状 + 环比百分比，随日/周/月/年切换；周视图默认对比上周）。
- 中：精力趋势（折线，多维；全部=本周四条；单维=本周一条+上周对比）。
- 右：突发任务（折线，默认周，本周 vs 上周）。
- 下：日历事件表格（按日分组，含时间段、标题、类别、时长、关联任务，随粒度联动）。

## 验收标准（MVP）
- 提供周视图 HTML 模板（`html/v1/`）且可用 Mock 数据渲染。
- 生成脚本可读取 `data/activitywatch/`、`data/mood/`、`data/calendar/`，输出 `html/output/weekly.html`。
- 缺数据/缺权限时在页面与日志中有明确提示，不报错退出。
- 耗时校验：显示实际总和与差值提示（若不一致）。
